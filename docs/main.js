!function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(s,h,function(i){return t[i]}.bind(null,h));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0)}([function(t,i,e){"use strict";e.r(i),e.d(i,"createLevel",(function(){return rt}));var s={};e.r(s),e.d(s,"level1",(function(){return lt})),e.d(s,"level2",(function(){return mt})),e.d(s,"level3",(function(){return pt}));let h;const a=t=>{h=t},n=(({root:t,handleLoad:i,handleStart:e,handleRender:s,handleUpdate:h,handleResize:a})=>{const n={},d={width:0,height:0,dt:0,time:0,tps:0,fps:0,loading:0,started:!1};let r=void 0;const o=[],l=()=>{let t=window.innerWidth,i=window.innerHeight;if(d.width!==t||d.height!==i){d.width=t,d.height=i;for(const e of o)e.canvas.width=t,e.canvas.height=i;a(t,i)}},m=Date.now();let p=Date.now(),g=Date.now();const y=()=>{const t=Date.now(),i=(t-p)/1e3;p=t,d.dt=i,d.time=t-m,d.tps=Math.round(1/i);for(const t of o)t.opts.global&&t.ctx.clearRect(0,0,d.width,d.height);try{h(i)}catch(t){console.error(t)}void 0!==r&&setTimeout(y,1e3/r)},x=()=>{const t=Date.now(),i=(t-g)/1e3;g=t,d.fps=Math.round(1/i),void 0===r&&y();for(const t of o)t.opts.global||!1!==t.opts.clear&&t.ctx.clearRect(0,0,d.width,d.height);try{s()}catch(t){console.error(t)}requestAnimationFrame(x)};window.addEventListener("resize",l),window.addEventListener("keydown",t=>{n[t.key]=!0}),window.addEventListener("keyup",t=>{n[t.key]=!1});const f=()=>{d.started=!0,l(),e(),requestAnimationFrame(x)};return{keys:n,data:d,start:()=>{d.started||(i(),0===d.loading&&f())},img:t=>{const i=new Image;return i.src=t,++d.loading,i.onload=()=>{d.started||0!=--d.loading||f()},i.onerror=()=>{d.started||0!=--d.loading||f()},i},layer:i=>((i={})=>{const e=document.createElement("canvas");e.style.position="fixed",e.style.left=0,e.style.top=0,e.style.right=0,e.style.bottom=0;const s={opts:i,canvas:e,ctx:e.getContext("2d")};return o.push(s),t.appendChild(e),s})(i),key:t=>n[t]||!1,setCustomTps:t=>{void 0===r&&void 0!==t&&setTimeout(y,1e3/t),r=t}}})({root:document.getElementById("root"),handleLoad:()=>{},handleStart:()=>{a(rt(levels.level1))},handleResize:()=>{},handleUpdate:t=>{h.update(t)},handleRender:()=>{h.render(),o.fillText("tps: "+n.data.tps,20,20),o.fillText("fps: "+n.data.fps,20,35)}}),d=n.layer({clear:!1}).ctx,r=n.layer().ctx,o=n.layer({global:!0}).ctx,l=(t,i)=>t.x<i.x+i.width/2+i.width/2&&t.x+t.width/2+i.width/2>i.x&&t.y<i.y+i.height/2+i.height/2&&t.y+t.height/2+i.height/2>i.y,m=t=>Math.floor(Math.random()*Math.floor(t)),p=(t,i,e,s)=>Math.sqrt(Math.pow(t-e,2)+Math.pow(i-s,2),2),g=(t,i,e,s,h)=>{r.save(),r.scale(44,44),r.translate(-s/2,-h/2),r.drawImage(t,i,e,s,h),r.restore()},y=(t,i,e,s,h)=>{d.save(),d.scale(44,44),d.translate(-s/2,-h/2),d.drawImage(t,i,e,s,h),d.restore()},x=(t,i,e,s,h,a,n)=>({level:t,x:i,y:e,width:s,height:h,frames:a,frameCount:a.length,life_time:n,time:0,frame:0,update(t){this.time+=t,this.time=Math.min(this.time,this.life_time),this.frame=Math.min(Math.floor(this.time/(this.life_time/this.frameCount)),this.frameCount-1),this.time>=this.life_time&&this.level.removeAnimation(this.id)},render(){g(this.frames[this.frame],this.x,this.y,this.width,this.height)}}),f=t=>n.img(t),w=t=>i=>i.map(i=>f(`${t}/${i}`)),v=w("assets/tiles");var c={0:{name:"grass",image:f("assets/tiles/grass/grass.png"),collide:!1,collideLevel:0,unresponsive:!0,maxSt:1,canHasBonus:!1},1:{name:"brick",image:f("assets/tiles/brick/brick.png"),shadow:f("assets/tiles/brick/shadow.png"),shadowWidth:1,shadowHeight:1,translateShadowY:.55,destroyFrames:v(["brick/brick_destroy1.png","brick/brick_destroy2.png","brick/brick_destroy3.png","brick/brick_destroy4.png"]),destroyTime:.3,collide:!0,collideLevel:1,unresponsive:!1,maxSt:1,canHasBonus:!0},2:{name:"hardWall",image:f("assets/tiles/hardWall/hardWall.png"),shadow:f("assets/tiles/hardWall/shadow.png"),shadowWidth:1,shadowHeight:1,translateShadowY:.55,collide:!0,collideLevel:2,unresponsive:!1,maxSt:1/0,canHasBonus:!1}};const u=w("assets/enemies/bat");var _={width:.4,height:.4,rendWidth:1,rendHeight:1.5,speed:4,frames:u(["bat1.png","bat2.png"]),deadFrames:u(["bat_dead1.png","bat_dead2.png","bat_dead3.png","bat_dead4.png","bat_dead5.png"]),translateY:0,shadow:f("assets/enemies/bat/shadow.png"),shadowWidth:1,shadowHeight:1,translateShadowY:.5};const T=(t,i,e)=>({level:t,x:i,y:e,nx:Math.round(i),ny:Math.round(e),dx:0,dy:0,dir:"rand",translateY:_.translateY,translateShadowY:_.translateShadowY,shadowWidth:_.shadowWidth,shadowHeight:_.shadowHeight,shadow:_.shadow,time:0,frameTimer:0,frame:0,frameCount:_.frames.length,frames:_.frames,deadFrames:_.deadFrames,width:_.width,height:_.height,rendWidth:_.rendWidth,rendHeight:_.rendHeight,speed:_.speed,entityName:"enemy",canMoveTo(t,i){return t>0&&t<this.level.map.length-1&&i>0&&i<this.level.map[t].length-1},canMoveToX(t,i){return t>0&&t<this.level.map.length-1},canMoveToY(t,i){return i>0&&i<this.level.map[t].length-1},update(t){this.time+=t,this.frameTimer+=t,this.frameTimer>.2&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.x+=this.dx,this.y+=this.dy,Math.abs(this.nx-this.x)<this.dx&&(this.x=this.nx),Math.abs(this.ny-this.y)<this.dy&&(this.y=this.ny),this.x==this.nx&&this.y==this.ny&&("rand"==this.dir&&(this.canMoveTo(this.x-1,this.y-1)?this.dir="leup":this.canMoveTo(this.x-1,this.y+1)?this.dir="ledo":this.canMoveTo(this.x+1,this.y-1)?this.dir="riup":this.canMoveTo(this.x+1,this.y+1)&&(this.dir="rido")),"leup"==this.dir?this.canMoveToX(this.x-1,this.y-1)?this.canMoveToY(this.x-1,this.y-1)||(this.dir="ledo"):this.dir="riup":"ledo"==this.dir?this.canMoveToX(this.x-1,this.y+1)?this.canMoveToY(this.x-1,this.y+1)||(this.dir="leup"):this.dir="rido":"riup"==this.dir?this.canMoveToX(this.x+1,this.y-1)?this.canMoveToY(this.x+1,this.y-1)||(this.dir="rido"):this.dir="leup":"rido"==this.dir&&(this.canMoveToX(this.x+1,this.y+1)?this.canMoveToY(this.x+1,this.y+1)||(this.dir="riup"):this.dir="ledo"),"leup"==this.dir&&(this.nx-=1,this.ny-=1),"ledo"==this.dir&&(this.nx-=1,this.ny+=1),"riup"==this.dir&&(this.nx+=1,this.ny-=1),"rido"==this.dir&&(this.nx+=1,this.ny+=1)),this.dx=0,this.dy=0,this.ny<this.y&&(this.dy=-t*this.speed),this.ny>this.y&&(this.dy=t*this.speed),this.nx<this.x&&(this.dx=-t*this.speed),this.nx>this.x&&(this.dx=t*this.speed)},render(){g(this.shadow,this.x,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.frames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight)},kill(){this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.deadFrames,.5)),this.level.removeEntity(this.id)}}),M=w("assets/explos");var b={width:.6,height:.6,rendWidth:1,rendHeight:1,centerFrames:M(["explos_center1.png","explos_center2.png","explos_center3.png","explos_center4.png","explos_center5.png","explos_center6.png"]),upFrames:M(["explos_up1.png","explos_up2.png","explos_up3.png","explos_up4.png","explos_up5.png","explos_up6.png"]),upEndFrames:M(["explos_up_end1.png","explos_up_end2.png","explos_up_end3.png","explos_up_end4.png","explos_up_end5.png","explos_up_end6.png"]),downFrames:M(["explos_down1.png","explos_down2.png","explos_down3.png","explos_down4.png","explos_down5.png","explos_down6.png"]),downEndFrames:M(["explos_down_end1.png","explos_down_end2.png","explos_down_end3.png","explos_down_end4.png","explos_down_end5.png","explos_down_end6.png"]),leftFrames:M(["explos_left1.png","explos_left2.png","explos_left3.png","explos_left4.png","explos_left5.png","explos_left6.png"]),leftEndFrames:M(["explos_left_end1.png","explos_left_end2.png","explos_left_end3.png","explos_left_end4.png","explos_left_end5.png","explos_left_end6.png"]),rightFrames:M(["explos_right1.png","explos_right2.png","explos_right3.png","explos_right4.png","explos_right5.png","explos_right6.png"]),rightEndFrames:M(["explos_right_end1.png","explos_right_end2.png","explos_right_end3.png","explos_right_end4.png","explos_right_end5.png","explos_right_end6.png"]),life_time:.3,kill_time:.1,rend_time:.3};const W=(t,i,e,s,h,a)=>({level:t,x:i,y:e,time:0,frameTimer:0,frameCount:b.centerFrames.length,centerFrames:b.centerFrames,upFrames:b.upFrames,upEndFrames:b.upEndFrames,downFrames:b.downFrames,downEndFrames:b.downEndFrames,leftFrames:b.leftFrames,leftEndFrames:b.leftEndFrames,rightFrames:b.rightFrames,rightEndFrames:b.rightEndFrames,frame:0,width:b.width,height:b.height,rendWidth:b.rendWidth,rendHeight:b.rendHeight,life_time:b.life_time,kill_time:b.kill_time,isRend:!1,rend_time:b.rend_time,entityName:"explos",dir:s,spread:!1,power:h,isBurn:a,canMoveTo(t,i){return!c[this.level.map[t][i].tile].collide||!(0===this.isBurn||1===this.isBurn&&c[this.level.map[t][i].tile].collideLevel>1)},spreadExplos(){for(let t=1;t<=this.power;++t){let i=this.x,e=this.y-t,s=this.power-t;if(!this.canMoveTo(i,e)){s=0,this.level.addEntity(W(this.level,i,e,"up",s)),this.level.damageTile(i,e,1);break}this.level.addEntity(W(this.level,i,e,"up",s)),this.level.damageTile(i,e,1)}for(let t=1;t<=this.power;++t){let i=this.x,e=this.y+t,s=this.power-t;if(!this.canMoveTo(i,e)){s=0,this.level.addEntity(W(this.level,i,e,"down",s)),this.level.damageTile(i,e,1);break}this.level.addEntity(W(this.level,i,e,"down",s)),this.level.damageTile(i,e,1)}for(let t=1;t<=this.power;++t){let i=this.x-t,e=this.y,s=this.power-t;if(!this.canMoveTo(i,e)){s=0,this.level.addEntity(W(this.level,i,e,"left",s)),this.level.damageTile(i,e,1);break}this.level.addEntity(W(this.level,i,e,"left",s)),this.level.damageTile(i,e,1)}for(let t=1;t<=this.power;++t){let i=this.x+t,e=this.y,s=this.power-t;if(!this.canMoveTo(i,e)){s=0,this.level.addEntity(W(this.level,i,e,"right",s)),this.level.damageTile(i,e,1);break}this.level.addEntity(W(this.level,i,e,"right",s)),this.level.damageTile(i,e,1)}},init(){0==this.power&&(this.spread=!0),this.spread||(this.spread=!0,"center"==this.dir&&this.spreadExplos())},update(t){this.time+=t,this.time=Math.min(this.time,this.life_time),this.frame=Math.min(Math.floor(this.time/(this.life_time/this.frameCount)),this.frameCount-1),this.time>=this.life_time&&this.level.removeEntity(this.id)},render(){this.isRend||(this.isRend=!0,"center"==this.dir?this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.centerFrames,this.rend_time)):"up"==this.dir?0!=this.power?this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.upFrames,this.rend_time)):this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.upEndFrames,this.rend_time)):"down"==this.dir?0!=this.power?this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.downFrames,this.rend_time)):this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.downEndFrames,this.rend_time)):"left"==this.dir?0!=this.power?this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.leftFrames,this.rend_time)):this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.leftEndFrames,this.rend_time)):"right"==this.dir&&(0!=this.power?this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.rightFrames,this.rend_time)):this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.rightEndFrames,this.rend_time))))}}),H=(t,i,e)=>({level:t,entity:i,delay:e,time:0,update(t){this.time+=t,this.time>=this.delay&&(this.level.addEntity(i),this.level.removeEntity(this.id))},render(){}});var k={width:1,height:1,rendWidth:1,rendHeight:1.5,life_time:3,frames:w("assets/bomb")(["bomb1.png","bomb2.png","bomb3.png","bomb4.png"])};const F=(t,i,e,s,h,a,n,d=!1)=>({level:t,x:i,y:e,nx:i,ny:e,dx:0,dy:0,time:0,power:s,isDouble:h,isBurn:a,isRadio:n,frameTimer:0,frameCount:k.frames.length,frames:k.frames,frame:0,width:k.width,height:k.height,rendWidth:k.rendWidth,rendHeight:k.rendHeight,life_time:k.life_time,entityName:"bomb",owner:d,activated:!1,isS:!1,setup(){this.isS=!0,this.level.map[this.x][this.y].hasBomb=!0},update(t){this.isS||this.setup(),this.time+=t,this.frameTimer+=t,this.frameTimer>.2&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.time>=this.life_time&&!this.isRadio&&this.activate()},render(){g(this.frames[this.frame],this.x,this.y,this.rendWidth,this.rendHeight)},activate(){this.activated||(this.activated=!0,!1!==this.owner&&--this.owner.bombCount,this.isDouble&&this.level.addEntity(H(this.level,W(this.level,this.x,this.y,"center",this.power,this.isBurn),.2)),this.level.map[this.x][this.y].hasBomb=!1,this.level.addEntity(W(this.level,this.x,this.y,"center",this.power,this.isBurn)),this.level.removeEntity(this.id))}});var Y={flame:{frames:w("assets/animations/flame")(["flame1.png","flame2.png","flame3.png","flame4.png"])},pointer:{frames:w("assets/animations/pointer")(["pointer.png"])}},C={flame:{sFrame:f("assets/bonuses/flame/flame.png"),varName:"power",maxCount:7,startCount:1,width:.8,height:.8,rendWidth:1,rendHeight:1},extraBomb:{sFrame:f("assets/bonuses/extra_bomb/extra_bomb.png"),varName:"maxBombCount",maxCount:8,startCount:1,width:.8,height:.8,rendWidth:1,rendHeight:1},rollers:{sFrame:f("assets/bonuses/rollers/rollers.png"),varName:"rollers",maxCount:4,startCount:1,width:.8,height:.8,rendWidth:1,rendHeight:1},protect:{sFrame:f("assets/bonuses/protect/protect.png"),varName:"protect",maxCount:1,startCount:0,width:.8,height:.8,rendWidth:1,rendHeight:1},burnWall:{sFrame:f("assets/bonuses/burn_wall/burn_wall.png"),varName:"burnWall",maxCount:1,startCount:0,width:.8,height:.8,rendWidth:1,rendHeight:1},doubleBomb:{sFrame:f("assets/bonuses/double_bomb/double_bomb.png"),varName:"doubleBomb",maxCount:1,startCount:0,width:.8,height:.8,rendWidth:1,rendHeight:1},radioBomb:{sFrame:f("assets/bonuses/radio_bomb/radio_bomb.png"),varName:"radioBomb",maxCount:1,startCount:0,width:.8,height:.8,rendWidth:1,rendHeight:1},throughBomb:{sFrame:f("assets/bonuses/through_bomb/through_bomb.png"),varName:"throughBomb",maxCount:1,startCount:0,width:.8,height:.8,rendWidth:1,rendHeight:1},throughWall:{sFrame:f("assets/bonuses/through_wall/through_wall.png"),varName:"throughWall",maxCount:1,startCount:0,width:.8,height:.8,rendWidth:1,rendHeight:1}};const S=(t,i,e,s)=>({level:t,x:i,y:e,time:0,sFrame:C[s].sFrame,varName:C[s].varName,maxCount:C[s].maxCount,width:C[s].width,height:C[s].height,rendWidth:C[s].rendWidth,rendHeight:C[s].rendHeight,entityName:"bonus",update(t){this.time+=t},render(){g(this.sFrame,this.x,this.y,this.rendWidth,this.rendHeight)},kill(t=!1){t&&this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,Y.flame.frames,.5)),this.level.removeEntity(this.id)}}),B=w("assets/enemies/head");var E={width:.4,height:.4,rendWidth:1,rendHeight:1.5,speed:3,frames:B(["head1.png","head2.png","head3.png","head4.png"]),deadFrames:B(["head_dead1.png","head_dead2.png","head_dead3.png","head_dead4.png","head_dead5.png"]),translateY:0,shadow:f("assets/enemies/head/shadow.png"),shadowWidth:1,shadowHeight:1,translateShadowY:.55};const N=(t,i,e)=>({level:t,x:i,y:e,nx:Math.round(i),ny:Math.round(e),dx:0,dy:0,dir:"rand",translateY:E.translateY,translateShadowY:E.translateShadowY,shadowWidth:E.shadowWidth,shadowHeight:E.shadowHeight,shadow:E.shadow,time:0,frameTimer:0,frame:0,frameCount:E.frames.length,frames:E.frames,deadFrames:E.deadFrames,width:E.width,height:E.height,rendWidth:E.rendWidth,rendHeight:E.rendHeight,speed:E.speed,entityName:"enemy",canMoveTo(t,i){return 1!=this.level.map[t][i].hasBomb&&!c[this.level.map[t][i].tile].collide},findPlayer(){let t={x:0,y:0,dist:1/0};for(const i of this.level.entities.values())if("player"==i.entityName){let e=p(this.x,this.y,i.x,i.y);t.dist>=e&&(t.dist=e,t.x=i.x,t.y=i.y)}if(t.dist!=1/0)return{x:t.x,y:t.y}},update(t){if(this.time+=t,this.frameTimer+=t,this.frameTimer>.75&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.x+=this.dx,this.y+=this.dy,Math.abs(this.nx-this.x)<this.dx&&(this.x=this.nx),Math.abs(this.ny-this.y)<this.dy&&(this.y=this.ny),this.x==this.nx&&this.y==this.ny){let t=this.findPlayer(),i="left",e="up";void 0!==t&&(t.x>this.x&&(i="right"),t.y>this.y&&(e="down")),"rand"==this.dir&&(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.canMoveTo(this.x,this.y+1)?this.dir="down":this.canMoveTo(this.x-1,this.y)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(this.dir="right")),"up"==this.dir?(this.canMoveTo(this.x,this.y-1)||(this.canMoveTo(this.x,this.y+1)?this.dir="down":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&(0==m(12)||"left"==i&&0!=m(3))?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(0==m(12)||"right"==i&&0!=m(3))&&(this.dir="right")):"down"==this.dir?(this.canMoveTo(this.x,this.y+1)||(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&(0==m(12)||"left"==i&&0!=m(3))?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(0==m(12)||"right"==i&&0!=m(3))&&(this.dir="right")):"left"==this.dir?(this.canMoveTo(this.x-1,this.y)||(this.canMoveTo(this.x+1,this.y)?this.dir="right":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&(0==m(12)||"up"==e&&0!=m(3))?this.dir="up":this.canMoveTo(this.x,this.y+1)&&(0==m(12)||"down"==e&&0!=m(3))&&(this.dir="down")):"right"==this.dir&&(this.canMoveTo(this.x+1,this.y)||(this.canMoveTo(this.x-1,this.y)?this.dir="left":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&(0==m(12)||"up"==e&&0!=m(3))?this.dir="up":this.canMoveTo(this.x,this.y+1)&&(0==m(12)||"down"==e&&0!=m(3))&&(this.dir="down")),"up"==this.dir&&(this.ny-=1),"down"==this.dir&&(this.ny+=1),"left"==this.dir&&(this.nx-=1),"right"==this.dir&&(this.nx+=1)}this.dx=0,this.dy=0,this.ny<this.y&&(this.dy=-t*this.speed),this.ny>this.y&&(this.dy=t*this.speed),this.nx<this.x&&(this.dx=-t*this.speed),this.nx>this.x&&(this.dx=t*this.speed)},render(){g(this.shadow,this.x,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.frames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight)},kill(){this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.deadFrames,.5)),this.level.removeEntity(this.id)}}),q=w("assets/enemies/iceCream");var A={width:.4,height:.4,rendWidth:1,rendHeight:1.5,speed:2,frames:q(["iceCream1.png","iceCream2.png","iceCream3.png","iceCream4.png"]),deadFrames:q(["iceCream_dead1.png","iceCream_dead2.png","iceCream_dead3.png","iceCream_dead4.png","iceCream_dead5.png"]),translateY:0,shadow:f("assets/enemies/iceCream/shadow.png"),shadowWidth:1,shadowHeight:1,translateShadowY:.5};const P=(t,i,e)=>({level:t,x:i,y:e,nx:Math.round(i),ny:Math.round(e),dx:0,dy:0,dir:"rand",translateY:A.translateY,translateShadowY:A.translateShadowY,shadowWidth:A.shadowWidth,shadowHeight:A.shadowHeight,shadow:A.shadow,time:0,frameTimer:0,frame:0,frameCount:A.frames.length,frames:A.frames,deadFrames:A.deadFrames,width:A.width,height:A.height,rendWidth:A.rendWidth,rendHeight:A.rendHeight,speed:A.speed,entityName:"enemy",canMoveTo(t,i){return 1!=this.level.map[t][i].hasBomb&&!c[this.level.map[t][i].tile].collide},update(t){this.time+=t,this.frameTimer+=t,this.frameTimer>.5&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.x+=this.dx,this.y+=this.dy,Math.abs(this.nx-this.x)<this.dx&&(this.x=this.nx),Math.abs(this.ny-this.y)<this.dy&&(this.y=this.ny),this.x==this.nx&&this.y==this.ny&&("rand"==this.dir&&(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.canMoveTo(this.x,this.y+1)?this.dir="down":this.canMoveTo(this.x-1,this.y)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(this.dir="right")),"up"==this.dir?this.canMoveTo(this.x,this.y-1)||(this.canMoveTo(this.x-1,this.y)&&0==m(8)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&0==m(8)?this.dir="right":this.canMoveTo(this.x,this.y+1)?this.dir="down":this.dir="rand"):"down"==this.dir?this.canMoveTo(this.x,this.y+1)||(this.canMoveTo(this.x-1,this.y)&&0==m(8)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&0==m(8)?this.dir="right":this.canMoveTo(this.x,this.y-1)?this.dir="up":this.dir="rand"):"left"==this.dir?this.canMoveTo(this.x-1,this.y)||(this.canMoveTo(this.x,this.y-1)&&0==m(8)?this.dir="up":this.canMoveTo(this.x,this.y+1)&&0==m(8)?this.dir="down":this.canMoveTo(this.x+1,this.y)?this.dir="right":this.dir="rand"):"right"==this.dir&&(this.canMoveTo(this.x+1,this.y)||(this.canMoveTo(this.x,this.y-1)&&0==m(8)?this.dir="up":this.canMoveTo(this.x,this.y+1)&&0==m(8)?this.dir="down":this.canMoveTo(this.x-1,this.y)?this.dir="left":this.dir="rand")),"up"==this.dir&&(this.ny-=1),"down"==this.dir&&(this.ny+=1),"left"==this.dir&&(this.nx-=1),"right"==this.dir&&(this.nx+=1)),this.dx=0,this.dy=0,this.ny<this.y&&(this.dy=-t*this.speed),this.ny>this.y&&(this.dy=t*this.speed),this.nx<this.x&&(this.dx=-t*this.speed),this.nx>this.x&&(this.dx=t*this.speed)},render(){g(this.shadow,this.x,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.frames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight)},kill(){this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.deadFrames,.5)),this.level.removeEntity(this.id)}}),R=w("assets/enemies/pillow");var L={width:.4,height:.4,rendWidth:1,rendHeight:1.5,speed:2,frames:R(["pillow1.png","pillow2.png","pillow3.png","pillow4.png"]),deadFrames:R(["pillow_dead1.png","pillow_dead2.png","pillow_dead3.png","pillow_dead4.png","pillow_dead5.png"]),translateY:0,shadow:f("assets/enemies/pillow/shadow.png"),shadowWidth:1,shadowHeight:1,translateShadowY:.45};const D=(t,i,e)=>({level:t,x:i,y:e,nx:Math.round(i),ny:Math.round(e),dx:0,dy:0,dir:"rand",translateY:L.translateY,translateShadowY:L.translateShadowY,shadowWidth:L.shadowWidth,shadowHeight:L.shadowHeight,shadow:L.shadow,time:0,frameTimer:0,frame:0,frameCount:L.frames.length,frames:L.frames,deadFrames:L.deadFrames,width:L.width,height:L.height,rendWidth:L.rendWidth,rendHeight:L.rendHeight,speed:L.speed,entityName:"enemy",canMoveTo(t,i){return 1!=this.level.map[t][i].hasBomb&&!c[this.level.map[t][i].tile].collide},update(t){this.time+=t,this.frameTimer+=t,this.frameTimer>1&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.x+=this.dx,this.y+=this.dy,Math.abs(this.nx-this.x)<this.dx&&(this.x=this.nx),Math.abs(this.ny-this.y)<this.dy&&(this.y=this.ny),this.x==this.nx&&this.y==this.ny&&("rand"==this.dir&&(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.canMoveTo(this.x,this.y+1)?this.dir="down":this.canMoveTo(this.x-1,this.y)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(this.dir="right")),"up"==this.dir?(this.canMoveTo(this.x,this.y-1)||(this.canMoveTo(this.x,this.y+1)?this.dir="down":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&0==m(6)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&0==m(6)&&(this.dir="right")):"down"==this.dir?(this.canMoveTo(this.x,this.y+1)||(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&0==m(6)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&0==m(6)&&(this.dir="right")):"left"==this.dir?(this.canMoveTo(this.x-1,this.y)||(this.canMoveTo(this.x+1,this.y)?this.dir="right":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&0==m(6)?this.dir="up":this.canMoveTo(this.x,this.y+1)&&0==m(6)&&(this.dir="down")):"right"==this.dir&&(this.canMoveTo(this.x+1,this.y)||(this.canMoveTo(this.x-1,this.y)?this.dir="left":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&0==m(6)?this.dir="up":this.canMoveTo(this.x,this.y+1)&&0==m(6)&&(this.dir="down")),"up"==this.dir&&(this.ny-=1),"down"==this.dir&&(this.ny+=1),"left"==this.dir&&(this.nx-=1),"right"==this.dir&&(this.nx+=1)),this.dx=0,this.dy=0,this.ny<this.y&&(this.dy=-t*this.speed),this.ny>this.y&&(this.dy=t*this.speed),this.nx<this.x&&(this.dx=-t*this.speed),this.nx>this.x&&(this.dx=t*this.speed)},render(){g(this.shadow,this.x,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.frames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight)},kill(){this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.deadFrames,.5)),this.level.removeEntity(this.id)}}),X=w("assets/player");var j={width:.8,height:.8,rendWidth:1.6,rendHeight:1.6,speed:4,upFrames:X(["player_up1.png","player_up2.png","player_up3.png","player_up4.png"]),downFrames:X(["player_down1.png","player_down2.png","player_down3.png","player_down4.png"]),leftFrames:X(["player_left1.png","player_left2.png","player_left3.png","player_left4.png"]),rightFrames:X(["player_right1.png","player_right2.png","player_right3.png","player_right4.png"]),deadFrames:X(["player_dead1.png","player_dead2.png","player_dead3.png"]),translateY:-.1,shadowWidth:1.1,shadowHeight:1.1,translateShadowX:.15,translateShadowY:.45,shadow:f("assets/player/shadow.png")};const O=(t,i,e,s)=>({level:t,x:i,y:e,nx:i,ny:e,dx:0,dy:0,translateY:j.translateY,translateShadowY:j.translateShadowY,translateShadowX:j.translateShadowX,dir:"down",time:0,frameTimer:0,frameCount:j.upFrames.length,upFrames:j.upFrames,downFrames:j.downFrames,leftFrames:j.leftFrames,rightFrames:j.rightFrames,deadFrames:j.deadFrames,shadowWidth:j.shadowWidth,shadowHeight:j.shadowHeight,shadow:j.shadow,frame:0,putBombTimer:10,touchToBomb:!1,power:C.flame.startCount,maxBombCount:C.extraBomb.startCount,bombCount:0,rollers:C.rollers.startCount,protect:C.protect.startCount,burnWall:C.burnWall.startCount,doubleBomb:C.doubleBomb.startCount,radioBomb:C.radioBomb.startCount,canActivateRadioBomb:!0,radioBombs:[],throughBomb:C.throughBomb.startCount,throughWall:C.throughWall.startCount,width:j.width,height:j.height,rendWidth:j.rendWidth,rendHeight:j.rendHeight,speed:j.speed,entityName:"player",controls:s,touchToB:new Map,canMoveTo(t,i){return(!0!==this.level.map[t][i].hasBomb||0!==this.throughBomb)&&(!c[this.level.map[t][i].tile].collide||!(0===this.throughWall||1===this.throughWall&&c[this.level.map[t][i].tile].collideLevel>1))},update(t){this.time+=t,this.putBombTimer+=t,this.frameTimer+=t,this.frameTimer>.125&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount);for(const i of this.touchToB.keys())this.touchToB.set(i,this.touchToB.get(i)-t);if(this.speed=j.speed,this.speed*=Math.log2(this.rollers)/3+1,this.dx=0,this.dy=0,app.key(this.controls.up)&&(this.dy-=this.speed*t,this.dir="up"),app.key(this.controls.down)&&(this.dy+=this.speed*t,this.dir="down"),app.key(this.controls.left)&&(this.dx-=this.speed*t,this.dir="left"),app.key(this.controls.right)&&(this.dx+=this.speed*t,this.dir="right"),app.key(this.controls.fire1)&&this.putBombTimer>.1&&(this.putBombTimer=0,this.bombCount<this.maxBombCount&&!this.touchToBomb)){const t=F(this.level,Math.round(this.x),Math.round(this.y),this.power,this.doubleBomb,this.burnWall,this.radioBomb,this);this.radioBomb&&this.radioBombs.push(t),this.level.addEntity(t),++this.bombCount}if(app.key(this.controls.fire2)){if(this.canActivateRadioBomb)for(;this.radioBombs.length>0;){const t=this.radioBombs.shift();if(!t.activated){t.activate();break}}this.canActivateRadioBomb=!1}else this.canActivateRadioBomb=!0;0===this.dx&&0===this.dy&&(this.dir="down",this.frame=0),this.x=this.nx,this.y=this.ny,this.touchToBomb=!1,this.move(t)},move(t){if(0===this.dx&&0===this.dy)return;let i=this.width,e=this.height,s=this.speed;for(let t=1;t<=s;++t){const t=this.nx,h=this.ny;this.nx+=this.dx/s,this.ny+=this.dy/s;for(let s=Math.round(h+.001-e/2);s<=Math.round(h-.001+e/2);++s)for(let e=Math.round(this.nx-i/2);e<=Math.round(this.nx+i/2);++e)p(t,h,e,s)<i/2+.49&&this.touchToB.set(1e4*e+s,.1),!this.canMoveTo(e,s)&&(this.touchToB.get(1e4*e+s)<=0||void 0===this.touchToB.get(1e4*e+s))&&(this.dx>0&&(this.nx=Math.min(this.nx,e-i/2-.5)),this.dx<0&&(this.nx=Math.max(this.nx,e+i/2+.5)));for(let s=Math.round(t+.01-i/2);s<=Math.round(t-.01+i/2);++s)for(let i=Math.round(this.ny-e/2);i<=Math.round(this.ny+e/2);++i)p(t,h,s,i)<e/2+.49&&this.touchToB.set(1e4*s+i,.1),!this.canMoveTo(s,i)&&(this.touchToB.get(1e4*s+i)<=0||void 0===this.touchToB.get(1e4*s+i))&&(this.dy>0&&(this.ny=Math.min(this.ny,i-e/2-.5)),this.dy<0&&(this.ny=Math.max(this.ny,i+e/2+.5)))}},render(){switch(this.dir){case"down":g(this.shadow,this.x,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.downFrames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight);break;case"up":g(this.shadow,this.x,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.upFrames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight);break;case"left":g(this.shadow,this.x-this.translateShadowX,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.leftFrames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight);break;case"right":g(this.shadow,this.x+this.translateShadowX,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.rightFrames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight)}},kill(){this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.deadFrames,.5)),this.level.removeEntity(this.id)}}),U=w("assets/enemies/sPillow");var I={width:.4,height:.4,rendWidth:.9,rendHeight:1.35,speed:2.25,frames:U(["sPillow1.png","sPillow2.png","sPillow3.png","sPillow4.png","sPillow5.png","sPillow6.png","sPillow7.png","sPillow8.png"]),deadFrames:U(["sPillow_dead1.png","sPillow_dead2.png","sPillow_dead3.png","sPillow_dead4.png","sPillow_dead5.png"]),translateY:0,shadow:f("assets/enemies/sPillow/shadow.png"),shadowWidth:.9,shadowHeight:.9,translateShadowY:.45};const z=(t,i,e)=>({level:t,x:i,y:e,nx:Math.round(i),ny:Math.round(e),dx:0,dy:0,dir:"rand",translateY:I.translateY,translateShadowY:I.translateShadowY,shadowWidth:I.shadowWidth,shadowHeight:I.shadowHeight,shadow:I.shadow,time:0,frameTimer:0,frame:0,frameCount:I.frames.length,frames:I.frames,deadFrames:I.deadFrames,width:I.width,height:I.height,rendWidth:I.rendWidth,rendHeight:I.rendHeight,speed:I.speed,entityName:"enemy",canMoveTo(t,i){return 1!=this.level.map[t][i].hasBomb&&!c[this.level.map[t][i].tile].collide},update(t){this.time+=t,this.frameTimer+=t,this.frameTimer>1&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.x+=this.dx,this.y+=this.dy,Math.abs(this.nx-this.x)<this.dx&&(this.x=this.nx),Math.abs(this.ny-this.y)<this.dy&&(this.y=this.ny),this.x==this.nx&&this.y==this.ny&&("rand"==this.dir&&(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.canMoveTo(this.x,this.y+1)?this.dir="down":this.canMoveTo(this.x-1,this.y)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(this.dir="right")),"up"==this.dir&&(this.canMoveTo(this.x,this.y-1)||(this.canMoveTo(this.x,this.y+1)?this.dir="down":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&0==m(3)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&0==m(3)?this.dir="right":this.canMoveTo(this.x,this.y+1)&&0==m(12)&&(this.dir="down")),"down"==this.dir&&(this.canMoveTo(this.x,this.y+1)||(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&0==m(3)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&0==m(3)?this.dir="right":this.canMoveTo(this.x,this.y-1)&&0==m(12)&&(this.dir="up")),"left"==this.dir&&(this.canMoveTo(this.x-1,this.y)||(this.canMoveTo(this.x+1,this.y)?this.dir="right":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&0==m(3)?this.dir="up":this.canMoveTo(this.x,this.y+1)&&0==m(3)?this.dir="down":this.canMoveTo(this.x+1,this.y)&&0==m(12)&&(this.dir="right")),"right"==this.dir&&(this.canMoveTo(this.x+1,this.y)||(this.canMoveTo(this.x-1,this.y)?this.dir="left":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&0==m(3)?this.dir="up":this.canMoveTo(this.x,this.y+1)&&0==m(3)?this.dir="down":this.canMoveTo(this.x-1,this.y)&&0==m(12)&&(this.dir="left")),"up"==this.dir&&(this.ny-=1),"down"==this.dir&&(this.ny+=1),"left"==this.dir&&(this.nx-=1),"right"==this.dir&&(this.nx+=1)),this.dx=0,this.dy=0,this.ny<this.y&&(this.dy=-t*this.speed),this.ny>this.y&&(this.dy=t*this.speed),this.nx<this.x&&(this.dx=-t*this.speed),this.nx>this.x&&(this.dx=t*this.speed)},render(){g(this.shadow,this.x,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.frames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight)},kill(){this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.deadFrames,.5)),this.level.removeEntity(this.id)}}),$=w("assets/enemies/tripod");var G={width:.4,height:.4,rendWidth:1,rendHeight:1.5,speed:2.5,frames:$(["tripod1.png","tripod2.png","tripod3.png","tripod4.png"]),deadFrames:$(["tripod_dead1.png","tripod_dead2.png","tripod_dead3.png","tripod_dead4.png","tripod_dead5.png"]),translateY:0,shadow:f("assets/enemies/tripod/shadow.png"),shadowWidth:1,shadowHeight:1,translateShadowY:.6};const J=(t,i,e)=>({level:t,x:i,y:e,nx:Math.round(i),ny:Math.round(e),dx:0,dy:0,dir:"rand",translateY:G.translateY,translateShadowY:G.translateShadowY,shadowWidth:G.shadowWidth,shadowHeight:G.shadowHeight,shadow:G.shadow,time:0,frameTimer:0,frame:0,frameCount:G.frames.length,frames:G.frames,deadFrames:G.deadFrames,width:G.width,height:G.height,rendWidth:G.rendWidth,rendHeight:G.rendHeight,speed:G.speed,entityName:"enemy",canMoveTo(t,i){return 1!=this.level.map[t][i].hasBomb&&(!c[this.level.map[t][i].tile].collide||c[this.level.map[t][i].tile].collideLevel<=1)},findPlayer(){let t={x:0,y:0,dist:1/0};for(const i of this.level.entities.values())if("player"==i.entityName){let e=p(this.x,this.y,i.x,i.y);t.dist>=e&&(t.dist=e,t.x=i.x,t.y=i.y)}if(t.dist!=1/0)return{x:t.x,y:t.y}},update(t){if(this.time+=t,this.frameTimer+=t,this.frameTimer>.3&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.x+=this.dx,this.y+=this.dy,Math.abs(this.nx-this.x)<this.dx&&(this.x=this.nx),Math.abs(this.ny-this.y)<this.dy&&(this.y=this.ny),this.x==this.nx&&this.y==this.ny){let t=this.findPlayer(),i="left",e="up";void 0!==t&&(t.x>this.x&&(i="right"),t.y>this.y&&(e="down")),"rand"==this.dir&&(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.canMoveTo(this.x,this.y+1)?this.dir="down":this.canMoveTo(this.x-1,this.y)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(this.dir="right")),"up"==this.dir?(this.canMoveTo(this.x,this.y-1)||(this.canMoveTo(this.x,this.y+1)?this.dir="down":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&(0==m(8)||"left"==i&&0==m(2))?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(0==m(8)||"right"==i&&0==m(2))&&(this.dir="right")):"down"==this.dir?(this.canMoveTo(this.x,this.y+1)||(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&(0==m(8)||"left"==i&&0==m(2))?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(0==m(8)||"right"==i&&0==m(2))&&(this.dir="right")):"left"==this.dir?(this.canMoveTo(this.x-1,this.y)||(this.canMoveTo(this.x+1,this.y)?this.dir="right":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&(0==m(8)||"up"==e&&0==m(2))?this.dir="up":this.canMoveTo(this.x,this.y+1)&&(0==m(8)||"down"==e&&0==m(2))&&(this.dir="down")):"right"==this.dir&&(this.canMoveTo(this.x+1,this.y)||(this.canMoveTo(this.x-1,this.y)?this.dir="left":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&(0==m(8)||"up"==e&&0==m(2))?this.dir="up":this.canMoveTo(this.x,this.y+1)&&(0==m(8)||"down"==e&&0==m(2))&&(this.dir="down")),"up"==this.dir&&(this.ny-=1),"down"==this.dir&&(this.ny+=1),"left"==this.dir&&(this.nx-=1),"right"==this.dir&&(this.nx+=1)}this.dx=0,this.dy=0,this.ny<this.y&&(this.dy=-t*this.speed),this.ny>this.y&&(this.dy=t*this.speed),this.nx<this.x&&(this.dx=-t*this.speed),this.nx>this.x&&(this.dx=t*this.speed)},render(){g(this.shadow,this.x,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.frames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight)},kill(){this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.deadFrames,.5)),this.level.removeEntity(this.id)}}),K=w("assets/enemies/worm");var Q={width:.4,height:.4,rendWidth:1,rendHeight:1.5,speed:1.2,frames:K(["worm1.png","worm2.png","worm3.png","worm4.png"]),deadFrames:K(["worm_dead1.png","worm_dead2.png","worm_dead3.png","worm_dead4.png","worm_dead5.png"]),translateY:0,shadow:f("assets/enemies/worm/shadow.png"),shadowWidth:1.1,shadowHeight:1.1,translateShadowY:.7};const V=(t,i,e)=>({level:t,x:i,y:e,nx:Math.round(i),ny:Math.round(e),dx:0,dy:0,dir:"rand",translateY:Q.translateY,translateShadowY:Q.translateShadowY,shadowWidth:Q.shadowWidth,shadowHeight:Q.shadowHeight,shadow:Q.shadow,time:0,frameTimer:0,frame:0,frameCount:Q.frames.length,frames:Q.frames,deadFrames:Q.deadFrames,width:Q.width,height:Q.height,rendWidth:Q.rendWidth,rendHeight:Q.rendHeight,speed:Q.speed,entityName:"enemy",canMoveTo(t,i){return 1!=this.level.map[t][i].hasBomb&&!c[this.level.map[t][i].tile].collide},findPlayer(){let t={x:0,y:0,dist:1/0};for(const i of this.level.entities.values())if("player"==i.entityName){let e=p(this.x,this.y,i.x,i.y);t.dist>=e&&(t.dist=e,t.x=i.x,t.y=i.y)}if(t.dist!=1/0)return{x:t.x,y:t.y}},update(t){if(this.time+=t,this.frameTimer+=t,this.frameTimer>1&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.x+=this.dx,this.y+=this.dy,Math.abs(this.nx-this.x)<this.dx&&(this.x=this.nx),Math.abs(this.ny-this.y)<this.dy&&(this.y=this.ny),this.x==this.nx&&this.y==this.ny){let t=this.findPlayer(),i="left",e="up";void 0!==t&&(t.x>this.x&&(i="right"),t.y>this.y&&(e="down")),"rand"==this.dir&&(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.canMoveTo(this.x,this.y+1)?this.dir="down":this.canMoveTo(this.x-1,this.y)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(this.dir="right")),"up"==this.dir?(this.canMoveTo(this.x,this.y-1)||(this.canMoveTo(this.x,this.y+1)?this.dir="down":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&(0==m(12)||"left"==i&&0!=m(3))?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(0==m(12)||"right"==i&&0!=m(3))&&(this.dir="right")):"down"==this.dir?(this.canMoveTo(this.x,this.y+1)||(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&(0==m(12)||"left"==i&&0!=m(3))?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(0==m(12)||"right"==i&&0!=m(3))&&(this.dir="right")):"left"==this.dir?(this.canMoveTo(this.x-1,this.y)||(this.canMoveTo(this.x+1,this.y)?this.dir="right":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&(0==m(12)||"up"==e&&0!=m(3))?this.dir="up":this.canMoveTo(this.x,this.y+1)&&(0==m(12)||"down"==e&&0!=m(3))&&(this.dir="down")):"right"==this.dir&&(this.canMoveTo(this.x+1,this.y)||(this.canMoveTo(this.x-1,this.y)?this.dir="left":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&(0==m(12)||"up"==e&&0!=m(3))?this.dir="up":this.canMoveTo(this.x,this.y+1)&&(0==m(12)||"down"==e&&0!=m(3))&&(this.dir="down")),"up"==this.dir&&(this.ny-=1),"down"==this.dir&&(this.ny+=1),"left"==this.dir&&(this.nx-=1),"right"==this.dir&&(this.nx+=1)}this.dx=0,this.dy=0,this.ny<this.y&&(this.dy=-t*this.speed),this.ny>this.y&&(this.dy=t*this.speed),this.nx<this.x&&(this.dx=-t*this.speed),this.nx>this.x&&(this.dx=t*this.speed)},render(){g(this.shadow,this.x,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),g(this.frames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight)},kill(){this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.deadFrames,.5)),this.level.removeEntity(this.id)}}),Z=w("assets/bosses/snake");var tt={width:1,height:1,rendWidth:1,rendHeight:1.5,speed:1,frames:{dead:Z(["snake_dead1.png","snake_dead2.png","snake_dead3.png","snake_dead4.png","snake_dead5.png","snake_dead6.png"]),headUp:Z(["snake_head_up.png"]),headDown:Z(["snake_head_down.png"]),headLeft:Z(["snake_head_left1.png","snake_head_left2.png","snake_head_left3.png","snake_head_left4.png"]),headRight:Z(["snake_head_right1.png","snake_head_right2.png","snake_head_right3.png","snake_head_right4.png"]),segUp:Z(["snake_seg_up1.png","snake_seg_up2.png"]),segDown:Z(["snake_seg_down1.png","snake_seg_down2.png"]),segLeft:Z(["snake_seg_left1.png","snake_seg_left2.png"]),segRight:Z(["snake_seg_right1.png","snake_seg_right2.png"]),hvostUp:Z(["snake_hvost_up1.png","snake_hvost_up2.png","snake_hvost_up3.png","snake_hvost_up4.png"]),hvostDown:Z(["snake_hvost_down1.png","snake_hvost_down2.png","snake_hvost_down3.png","snake_hvost_down4.png"]),hvostLeft:Z(["snake_hvost_left1.png","snake_hvost_left2.png","snake_hvost_left3.png","snake_hvost_left4.png"]),hvostRight:Z(["snake_hvost_right1.png","snake_hvost_right2.png","snake_hvost_right3.png","snake_hvost_right4.png"])}};const it=(t,i,e,s)=>({level:t,x:i,y:e,dc:1,segments:[],segSt:1,time:0,resistTimer:0,resistTime:2,isRend:!0,frameTimer:0,frameCount:4,frame:0,width:tt.width,height:tt.height,rendWidth:tt.rendWidth,rendHeight:tt.rendHeight,speed:tt.speed,canMove:!0,entityName:"snake",length:s,isS:!1,canMoveTo(t,i){return!0!==this.level.map[t][i].hasBomb&&!c[this.level.map[t][i].tile].collide},findPlayers(){let t=[];for(const i of this.level.entities.values())if("player"===i.entityName){let e=p(this.segments[0].x,this.segments[0].y,i.x,i.y);t.push({x:i.x,y:i.y,dist:e})}return t.sort((t,i)=>t.dist>i.dist?1:-1),t},setup(){this.isS=!0;for(let t=1;t<=this.length;++t)this.segments.push({x:this.x,y:this.y+1,dir:"up",move:t-1})},update(t){if(this.isS||this.setup(),this.time+=t,this.frameTimer+=t,this.resistTimer+=t,this.frameTimer>.8&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.resistTimer<=this.resistTime?this.isRend=Math.floor(this.resistTimer/(this.resistTime/16))%2:this.isRend=!0,this.dc>=1){for(let t=this.segments.length-1;t>=0;--t)this.segments[t].move>=1?this.segments[t].move-=1:("up"==this.segments[t].dir?this.segments[t].y-=1:"down"==this.segments[t].dir?this.segments[t].y+=1:"left"==this.segments[t].dir?this.segments[t].x-=1:"right"==this.segments[t].dir&&(this.segments[t].x+=1),t>0&&(this.segments[t].dir=this.segments[t-1].dir));this.dc-=1;let t=new Map;t.set(1e4*this.segments[0].x+this.segments[0].y,0);let i=[{x:this.segments[0].x,y:this.segments[0].y}],e=(e,s,h,a)=>{let n=t.get(1e4*e+s)+1;(void 0===t.get(1e4*h+a)||n<=t.get(1e4*h+a))&&this.canMoveTo(h,a)&&(i.push({x:h,y:a}),t.set(1e4*h+a,n))};for(;0!=i.length;){let{x:t,y:s}=i.shift();e(t,s,t,s-1),e(t,s,t,s+1),e(t,s,t-1,s),e(t,s,t+1,s)}let s=this.findPlayers(),h="rand";if(0!==s.length)for(const i of s)if(void 0!==t.get(1e4*Math.round(i.x)+Math.round(i.y))){for(let e=Math.round(i.x),s=Math.round(i.y);e!==this.segments[0].x||s!==this.segments[0].y;)t.get(1e4*e+s-1)===t.get(1e4*e+s)-1?(h="down",s-=1):t.get(1e4*e+s+1)===t.get(1e4*e+s)-1?(h="up",s+=1):t.get(1e4*(e-1)+s)===t.get(1e4*e+s)-1?(h="right",e-=1):t.get(1e4*(e+1)+s)===t.get(1e4*e+s)-1&&(h="left",e+=1);break}this.segments[0].dir=h,("up"!==this.segments[0].dir||this.canMoveTo(this.segments[0].x,this.segments[0].y-1))&&("down"!==this.segments[0].dir||this.canMoveTo(this.segments[0].x,this.segments[0].y+1))&&("left"!==this.segments[0].dir||this.canMoveTo(this.segments[0].x-1,this.segments[0].y))&&("right"!==this.segments[0].dir||this.canMoveTo(this.segments[0].x+1,this.segments[0].y))||(this.segments[0].dir="rand"),"rand"===this.segments[0].dir&&(this.canMoveTo(this.segments[0].x,this.segments[0].y-1)?this.segments[0].dir="up":this.canMoveTo(this.segments[0].x,this.segments[0].y+1)?this.segments[0].dir="down":this.canMoveTo(this.segments[0].x-1,this.segments[0].y)?this.segments[0].dir="left":this.canMoveTo(this.segments[0].x+1,this.segments[0].y)&&(this.segments[0].dir="right"))}this.canMoveTo(this.segments[0].x,this.segments[0].y-1)||this.canMoveTo(this.segments[0].x,this.segments[0].y+1)||this.canMoveTo(this.segments[0].x-1,this.segments[0].y)||this.canMoveTo(this.segments[0].x+1,this.segments[0].y)?this.canMove=!0:(this.canMove=!1,this.segments[0].dir="down"),this.canMove&&(this.dc+=this.speed*t)},render(){if(this.isRend)for(let t=this.segments.length-1;t>=0;--t){let i,e=this.segments[t],{x:s,y:h,dir:a}=e;switch(a){case"up":h-=this.dc;break;case"down":h+=this.dc;break;case"left":s-=this.dc;break;case"right":s+=this.dc}switch(t){case 0:i="head";break;case this.segments.length-1:i="hvost";break;default:i="seg"}const n=tt.frames[i+a[0].toUpperCase()+a.substr(1)];g(n[this.frame%n.length],s,h,this.rendWidth,this.rendHeight)}},kill(){this.level.removeEntity(this.id)},damage(){this.resistTimer>this.resistTime&&(this.resistTimer=0,this.segSt-=1,this.segSt<=0&&(this.segments.pop(),this.segSt+=1),0==this.segments.length&&this.kill())}}),et=w("assets/enemies/queen_fragment");var st={width:.4,height:.4,rendWidth:1,rendHeight:1.5,speed:2.25,frames:et(["queen_fragment1.png","queen_fragment2.png"]),deadFrames:et(["queen_fragment_dead1.png","queen_fragment_dead2.png","queen_fragment_dead3.png","queen_fragment_dead4.png","queen_fragment_dead5.png"]),bornFrames:et(["queen_fragment_born1.png","queen_fragment_born2.png","queen_fragment_born3.png","queen_fragment_born4.png"]),born_time:5,translateY:0,shadow:f("assets/enemies/queen_fragment/shadow.png"),shadowWidth:.9,shadowHeight:.9,translateShadowY:.45};const ht=(t,i,e)=>({level:t,x:i,y:e,nx:Math.round(i),ny:Math.round(e),dx:0,dy:0,dir:"rand",translateY:st.translateY,translateShadowY:st.translateShadowY,shadowWidth:st.shadowWidth,shadowHeight:st.shadowHeight,shadow:st.shadow,born_time:st.born_time,time:0,frameTimer:0,frame:0,frameCount:st.frames.length,frames:st.frames,deadFrames:st.deadFrames,bornFrames:st.bornFrames,width:st.width,height:st.height,rendWidth:st.rendWidth,rendHeight:st.rendHeight,speed:st.speed,entityName:"enemy",isS:!1,canMoveTo(t,i){return 1!=this.level.map[t][i].hasBomb&&!c[this.level.map[t][i].tile].collide},setup(){this.isS=!0,this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.bornFrames,this.born_time))},update(t){this.isS||this.setup(),this.time+=t,this.frameTimer+=t,this.frameTimer>.5&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.x+=this.dx,this.y+=this.dy,Math.abs(this.nx-this.x)<this.dx&&(this.x=this.nx),Math.abs(this.ny-this.y)<this.dy&&(this.y=this.ny),this.x==this.nx&&this.y==this.ny&&("rand"==this.dir&&(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.canMoveTo(this.x,this.y+1)?this.dir="down":this.canMoveTo(this.x-1,this.y)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&(this.dir="right")),"up"==this.dir?(this.canMoveTo(this.x,this.y-1)||(this.canMoveTo(this.x,this.y+1)?this.dir="down":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&0==m(2)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&0==m(2)?this.dir="right":this.canMoveTo(this.x,this.y+1)&&0==m(12)&&(this.dir="down")):"down"==this.dir?(this.canMoveTo(this.x,this.y+1)||(this.canMoveTo(this.x,this.y-1)?this.dir="up":this.dir="rand"),this.canMoveTo(this.x-1,this.y)&&0==m(2)?this.dir="left":this.canMoveTo(this.x+1,this.y)&&0==m(2)?this.dir="right":this.canMoveTo(this.x,this.y-1)&&0==m(12)&&(this.dir="up")):"left"==this.dir?(this.canMoveTo(this.x-1,this.y)||(this.canMoveTo(this.x+1,this.y)?this.dir="right":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&0==m(2)?this.dir="up":this.canMoveTo(this.x,this.y+1)&&0==m(2)?this.dir="down":this.canMoveTo(this.x+1,this.y)&&0==m(12)&&(this.dir="right")):"right"==this.dir&&(this.canMoveTo(this.x+1,this.y)||(this.canMoveTo(this.x-1,this.y)?this.dir="left":this.dir="rand"),this.canMoveTo(this.x,this.y-1)&&0==m(2)?this.dir="up":this.canMoveTo(this.x,this.y+1)&&0==m(2)?this.dir="down":this.canMoveTo(this.x-1,this.y)&&0==m(12)&&(this.dir="left")),"up"==this.dir&&(this.ny-=1),"down"==this.dir&&(this.ny+=1),"left"==this.dir&&(this.nx-=1),"right"==this.dir&&(this.nx+=1)),this.dx=0,this.dy=0,this.ny<this.y&&(this.dy=-t*this.speed),this.ny>this.y&&(this.dy=t*this.speed),this.nx<this.x&&(this.dx=-t*this.speed),this.nx>this.x&&(this.dx=t*this.speed),this.time<this.born_time&&(this.dx=0,this.dy=0)},render(){g(this.shadow,this.x,this.y+this.translateShadowY,this.shadowWidth,this.shadowHeight),this.time>=this.born_time&&g(this.frames[this.frame],this.x,this.y+this.translateY,this.rendWidth,this.rendHeight)},kill(){this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.deadFrames,.5)),this.level.removeEntity(this.id)}}),at=w("assets/bosses/queen");var nt={width:.4,height:.4,rendWidth:1,rendHeight:1.5,speed1:1,speed2:2,speed3:1,frames1:at(["queen1_1.png","queen1_2.png","queen1_3.png","queen1_4.png"]),frames2:at(["queen2_1.png","queen2_2.png","queen2_3.png","queen2_4.png"]),frames3:at(["queen3_1.png","queen3_2.png","queen3_3.png","queen3_4.png"]),deadFrames:at(["queen_dead1.png","queen_dead2.png","queen_dead3.png","queen_dead4.png","queen_dead5.png"])};const dt=(t,i,e)=>({level:t,x:i,y:e,nx:Math.round(i),ny:Math.round(e),dx:0,dy:0,dir:"rand",time:0,resistTimer:0,resistTime:2,isRend:!0,frameTimer:0,frame:0,frameCount:nt.frames1.length,frames1:nt.frames1,frames2:nt.frames2,frames3:nt.frames3,state:1,deadFrames:nt.deadFrames,width:nt.width,height:nt.height,rendWidth:nt.rendWidth,rendHeight:nt.rendHeight,speed1:nt.speed1,speed2:nt.speed2,speed3:nt.speed3,entityName:"queen",canMoveTo(t,i){return 1!=this.level.map[t][i].hasBomb&&!c[this.level.map[t][i].tile].collide},findPlayers(){let t=[];for(const i of this.level.entities.values())if("player"===i.entityName){let e=p(this.x,this.y,i.x,i.y);t.push({x:i.x,y:i.y,dist:e})}return t.sort((t,i)=>t.dist>i.dist?1:-1),t},update(t){if(this.time+=t,this.frameTimer+=t,this.resistTimer+=t,this.frameTimer>.3&&(this.frameTimer=0,++this.frame,this.frame=this.frame%this.frameCount),this.resistTimer<=this.resistTime?this.isRend=Math.floor(this.resistTimer/(this.resistTime/16))%2:this.isRend=!0,this.x+=this.dx,this.y+=this.dy,Math.abs(this.nx-this.x)<this.dx&&(this.x=this.nx),Math.abs(this.ny-this.y)<this.dy&&(this.y=this.ny),this.x==this.nx&&this.y==this.ny){0===this.dx&&0===this.dy||this.level.addEntity(ht(this.level,this.x,this.y));let t=new Map;t.set(1e4*this.x+this.y,0);let i=[{x:this.x,y:this.y}],e=(e,s,h,a)=>{let n=t.get(1e4*e+s)+1;(void 0===t.get(1e4*h+a)||n<=t.get(1e4*h+a))&&this.canMoveTo(h,a)&&(i.push({x:h,y:a}),t.set(1e4*h+a,n))};for(;0!=i.length;){let{x:t,y:s}=i.shift();e(t,s,t,s-1),e(t,s,t,s+1),e(t,s,t-1,s),e(t,s,t+1,s)}let s=this.findPlayers(),h="rand";if(0!==s.length)for(const i of s)if(void 0!==t.get(1e4*Math.round(i.x)+Math.round(i.y))){for(let e=Math.round(i.x),s=Math.round(i.y);e!==this.x||s!==this.y;)t.get(1e4*e+s-1)===t.get(1e4*e+s)-1?(h="down",s-=1):t.get(1e4*e+s+1)===t.get(1e4*e+s)-1?(h="up",s+=1):t.get(1e4*(e-1)+s)===t.get(1e4*e+s)-1?(h="right",e-=1):t.get(1e4*(e+1)+s)===t.get(1e4*e+s)-1&&(h="left",e+=1);break}this.dir=h,"up"==this.dir&&(this.ny-=1),"down"==this.dir&&(this.ny+=1),"left"==this.dir&&(this.nx-=1),"right"==this.dir&&(this.nx+=1)}this.dx=0,this.dy=0,this.ny<this.y&&(this.dy=-t*this["speed"+this.state]),this.ny>this.y&&(this.dy=t*this["speed"+this.state]),this.nx<this.x&&(this.dx=-t*this["speed"+this.state]),this.nx>this.x&&(this.dx=t*this["speed"+this.state])},render(){this.isRend&&g(this["frames"+this.state][this.frame],this.x,this.y,this.rendWidth,this.rendHeight)},kill(){this.level.addAnimation(x(this.level,this.x,this.y,this.rendWidth,this.rendHeight,this.deadFrames,.5)),this.level.removeEntity(this.id)},damage(){this.resistTimer>this.resistTime&&(this.resistTimer=0,this.state+=1,this.state>3&&this.kill())}}),rt=t=>({map:t.tileMap,startEntities:t.startEntities,bonuses:t.bonuses,entities:new Map,animations:new Map,isS:!1,setup(){this.isS=!0;let t=[];for(let i=0;i<this.map.length;++i)for(let e=0;e<this.map[i].length;++e)void 0===this.map[i][e].tile&&(this.map[i][e]={tile:this.map[i][e]}),this.map[i][e].st=c[this.map[i][e].tile].maxSt,c[this.map[i][e].tile].canHasBonus&&t.push({x:i,y:e});for(const i in this.bonuses){if(0===t.length)break;for(let e=1;e<=this.bonuses[i]&&0!==t.length;++e){let e=m(t.length),s=t[e];this.map[s.x][s.y].bonus=i,t.splice(e,1)}}for(const t of this.startEntities)switch(t.name){case"player":this.addEntity(O(this,t.x,t.y,t.controls));break;case"bomb":this.addEntity(F(this,t.x,t.y,t.power));break;case"bonus":this.addEntity(S(this,t.x,t.y,t.bonusName));break;case"explos":this.addEntity(W(this,t.x,t.y,t.dir,t.power));break;case"iceCream":this.addEntity(P(this,t.x,t.y));break;case"pillow":this.addEntity(D(this,t.x,t.y));break;case"sPillow":this.addEntity(z(this,t.x,t.y));break;case"worm":this.addEntity(V(this,t.x,t.y));break;case"head":this.addEntity(N(this,t.x,t.y));break;case"tripod":this.addEntity(J(this,t.x,t.y));break;case"bat":this.addEntity(T(this,t.x,t.y));break;case"snake":this.addEntity(it(this,t.x,t.y,t.length));break;case"queen":this.addEntity(dt(this,t.x,t.y));break;case"queen_fragment":this.addEntity(ht(this,t.x,t.y))}for(let t=this.map.length-1;t>=0;--t)for(let i=this.map[t].length-1;i>=0;--i){const e=this.map[t][i].tile;y(c[e].image,t,i,1,1),c[e].shadow&&!c[this.map[t][Math.min(i+1,this.map[t].length-1)].tile].shadow?(this.map[t][i].hasShadow=!0,y(c[e].shadow,t,i+c[e].translateShadowY,c[e].shadowWidth,c[e].shadowHeight)):this.map[t][i].hasShadow=!1}},update(t){this.isS||this.setup();const i=[...this.entities.values()];for(const e of i){e.update(t);for(const t of i)if(e.id!==t.id){if(l(e,t)){if("bomb"===e.entityName&&"explos"===t.entityName&&e.activate(),"bomb"===e.entityName&&"player"===t.entityName&&Math.round(t.x)===e.x&&Math.round(t.y)===e.y&&(t.touchToBomb=!0),"player"===e.entityName&&"explos"===t.entityName){if(1===e.protect)continue;if(t.time>=t.kill_time)continue;e.kill()}if("player"===e.entityName&&"bonus"===t.entityName){if(e[t.varName]>=t.maxCount)continue;e[t.varName]+=1,t.kill()}if("bonus"===e.entityName&&"explos"===t.entityName){if(t.time>=t.kill_time)continue;e.time>t.life_time+.01&&e.kill(!0)}if("enemy"===e.entityName&&"explos"===t.entityName){if(t.time>=t.kill_time)continue;e.kill()}"enemy"===e.entityName&&"player"===t.entityName&&t.kill(),"queen"===e.entityName&&"explos"===t.entityName&&e.damage(),"queen"===e.entityName&&"player"===t.entityName&&t.kill()}if("snake"===t.entityName)for(const i of t.segments){let s={x:i.x,y:i.y};switch(i.dir){case"up":s.y-=t.dc;break;case"down":s.y+=t.dc;break;case"left":s.x-=t.dc;break;case"right":s.x+=t.dc}if(l({x:e.x,y:e.y,width:e.width,height:e.height},{x:s.x,y:s.y,width:t.width,height:t.height}))switch(e.entityName){case"player":e.kill();break;case"explos":t.time>=t.kill_time||t.damage()}}}}for(const i of[...this.animations.values()])i.update(t)},render(){for(const t of this.entities.values())try{t.render()}catch(t){console.error(t)}for(const t of this.animations.values())t.render()},updateTile(t,i,e=!0){const s=this.map[t][i].tile;e&&y(c[s].image,t,i,1,1),!c[s].shadow&&this.map[t][i].hasShadow&&(this.map[t][i].hasShadow=!1,this.updateTile(t,i+1)),!c[s].shadow||c[this.map[t][Math.min(i+1,this.map[t].length-1)].tile].shadow||this.map[t][i].hasShadow||(this.hasShadow=!0,y(c[s].shadow,t,i+c[s].translateShadowY,c[s].shadowWidth,c[s].shadowHeight)),c[this.map[t][Math.max(i-1,0)].tile].shadow&&!this.map[t][Math.max(i-1,0)].hasShadow&&e&&(this.updateTile(t,Math.max(i-1,0),!1),this.map[t][Math.max(i-1,0)].hasShadow=!0)},damageTile(t,i,e){const s=this.map[t][i].tile;c[s].unresponsive||(this.map[t][i].st-=e,this.map[t][i].st<=0&&(void 0!==c[s].destroyFrames&&this.addAnimation(x(this,t,i,1,1,c[s].destroyFrames,c[s].destroyTime)),this.map[t][i].tile=0,this.map[t][i].st=1,this.updateTile(t,i),void 0!==this.map[t][i].bonus&&(this.addEntity(S(this,t,i,this.map[t][i].bonus)),this.map[t][i].bonus=void 0)))},addEntity(t){t.id=Symbol("id"),this.entities.set(t.id,t),t.init&&t.init()},removeEntity(t){this.entities.delete(t)},addAnimation(t){t.id=Symbol("id"),this.animations.set(t.id,t)},removeAnimation(t){this.animations.delete(t)}});var ot={player1:{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",fire1:" ",fire2:"."},player2:{up:"w",down:"s",left:"a",right:"d",fire1:"c",fire2:"e"}};const lt={tileMap:[[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,0,0,1,0,1,0,0,0,1,0,1,0,0,2],[2,0,2,0,2,1,2,1,2,1,2,1,2,0,2],[2,1,1,0,0,1,1,0,0,1,1,0,0,1,2],[2,0,2,1,2,0,2,1,2,0,2,0,2,0,2],[2,1,0,1,1,0,0,0,0,0,0,0,1,0,2],[2,1,2,0,2,0,2,1,2,0,2,1,2,1,2],[2,0,1,1,0,0,1,0,0,0,0,0,1,0,2],[2,1,2,0,2,1,2,1,2,1,2,0,2,1,2],[2,0,1,0,0,1,0,0,0,1,0,1,1,1,2],[2,1,2,0,2,1,2,0,2,1,2,1,2,0,2],[2,0,0,0,1,0,1,0,1,0,0,0,0,0,2],[2,0,2,1,2,1,2,1,2,1,2,1,2,0,2],[2,1,1,1,1,0,0,1,1,0,0,0,0,1,2],[2,0,2,1,2,1,2,1,2,1,2,1,2,0,2],[2,1,1,1,1,0,0,1,1,0,0,0,0,1,2],[2,0,2,1,2,1,2,1,2,1,2,1,2,0,2],[2,1,1,1,1,0,0,1,1,0,0,0,0,1,2],[2,0,2,1,2,1,2,1,2,1,2,1,2,0,2],[2,1,0,1,1,0,0,0,0,0,0,0,1,1,2],[2,0,2,1,2,1,2,1,2,1,2,1,2,0,2],[2,0,0,1,0,0,1,0,0,0,0,1,0,0,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]],startEntities:[{name:"player",x:21,y:13,controls:ot.player2},{name:"player",x:1,y:1,controls:ot.player1},{name:"iceCream",x:7,y:1},{name:"iceCream",x:5,y:5},{name:"pillow",x:5,y:5},{name:"pillow",x:15,y:1},{name:"sPillow",x:13,y:1},{name:"sPillow",x:5,y:8},{name:"worm",x:5,y:5},{name:"worm",x:3,y:3},{name:"head",x:8,y:6},{name:"tripod",x:8,y:6}],bonuses:{flame:4,extraBomb:4,rollers:2,protect:1,burnWall:1,doubleBomb:1,radioBomb:1,throughBomb:1,throughWall:1}},mt={tileMap:[[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,0,0,1,0,1,0,0,0,1,0,1,0,0,2],[2,0,2,0,2,0,2,1,2,0,2,1,2,0,2],[2,1,0,0,0,0,1,0,0,0,1,0,0,1,2],[2,0,2,1,2,0,2,1,2,0,2,0,2,0,2],[2,1,0,1,1,0,0,0,0,0,0,0,0,0,2],[2,1,2,0,2,0,2,1,2,0,2,1,2,1,2],[2,0,1,1,0,0,1,0,0,0,0,0,0,0,2],[2,1,2,0,2,1,2,1,2,0,2,0,2,0,2],[2,0,0,0,0,0,0,0,0,0,0,0,1,0,2],[2,1,2,0,2,0,2,0,2,1,2,0,2,0,2],[2,0,0,0,1,0,1,0,1,0,0,0,0,0,2],[2,0,2,1,2,0,2,0,2,1,2,0,2,0,2],[2,1,0,0,1,0,0,1,1,0,0,0,0,1,2],[2,0,2,0,2,0,2,0,2,0,2,1,2,0,2],[2,1,0,0,1,0,0,1,1,0,0,0,0,1,2],[2,0,2,1,2,1,2,0,2,1,2,0,2,0,2],[2,1,1,1,1,0,0,1,0,0,0,0,0,1,2],[2,0,2,0,2,1,2,0,2,1,2,0,2,0,2],[2,1,0,0,1,0,0,0,0,0,0,0,1,1,2],[2,0,2,0,2,1,2,1,2,1,2,1,2,0,2],[2,0,0,1,0,0,1,0,1,0,0,1,0,0,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]],startEntities:[{name:"player",x:21,y:13,controls:ot.player2},{name:"player",x:1,y:1,controls:ot.player1},{name:"head",x:8,y:6},{name:"head",x:8,y:6},{name:"head",x:8,y:6},{name:"tripod",x:8,y:6},{name:"bat",x:9,y:6}],bonuses:{flame:4,extraBomb:4,rollers:1,protect:1}},pt={tileMap:[[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,0,0,1,1,1,1,1,0,0,0,0,0,0,2],[2,0,2,0,2,0,2,0,2,0,2,0,2,0,2],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[2,0,2,0,2,0,2,0,2,0,2,0,2,0,2],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[2,0,2,0,2,0,2,0,2,0,2,0,2,0,2],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[2,0,2,0,2,0,2,0,2,0,2,0,2,0,2],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[2,0,2,0,2,0,2,0,2,0,2,0,2,0,2],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[2,0,2,0,2,0,2,0,2,0,2,0,2,0,2],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[2,0,2,0,2,0,2,0,2,0,2,0,2,0,2],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[2,0,2,0,2,0,2,0,2,0,2,0,2,2,2],[2,0,0,0,0,0,0,0,0,0,0,0,2,0,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]],startEntities:[{name:"player",x:17,y:13,controls:ot.player2},{name:"player",x:1,y:1,controls:ot.player1},{name:"snake",x:9,y:6,length:15},{name:"sPillow",x:9,y:6},{name:"sPillow",x:9,y:6},{name:"tripod",x:9,y:6},{name:"tripod",x:9,y:6},{name:"queen",x:11,y:8}],bonuses:{}};window.app=n,window.setLevel=a,window.levels=s,window.createLevel=rt,window.onload=()=>{n.start()}}]);